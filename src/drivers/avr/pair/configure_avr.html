<script type="text/javascript">

	Homey.setTitle( __("pair.config.title"));


    Homey.on('continue', function( success, callback) {
        Homey.showView('list_devices');
    })

	function  validateIPV4( addres ) {

        if (/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(addres))  {

            return true;
        }
        return false;
    }

	function checkIP() {
		var inputStr = $("#avrip").val();

		var inputAr = inputStr.split(":");

		var inputIP = inputAr[0];

		if ( validateIPV4( inputIP ) ) {
			console.log("checkip (", inputIP, ") returned: valid.");
			return true;
		} else {
			console.log("checkip (", inputIP, ") returned: invalid.");
			return false;
		}
	}

	function configure() {

		var inputStr       = $("#avrip").val();
		var avrname        = $("#avrname").val();
		var avrtype        = $("#avrtype").val();
		var avrsuccesCheck = 0;

		console.log( "inputStr = '",inputStr,"'");
		var inputAr = inputStr.split(":");

		var avrip = inputAr[0];

		if ( typeof( inputAr[1]) !== "undefined" ) {
			avrport = inputAr[1];
		} else {
			avrport = 23;
		}

		if ( avrtype === "" ) {
			Homey.alert( __('pair.config.emptyType'), 'error');
            console.log("No AVR type selected.");
            avrsuccesCheck = 1;
		}

		if ( avrname === "" ) {
			Homey.alert( __('pair.config.emptyName'), 'error');
            console.log("No name given.");
            avrsuccesCheck = 1;
		}

		if ( avrip === "" ) {
			Homey.alert( __('pair.config.emptyIP'), 'error');
            console.log("No ip address given.");
            avrsuccesCheck = 1;
		} else {
			if ( ! validateIPV4( avrip ) ) {
				Homey.alert( __('pair.config.invalidIP'), 'error');
                console.log("IP address invalid.");
                avrsuccesCheck = 1;
			}
		}

		if ( avrsuccesCheck === 0 ) {

			var data = {
				avrip:    avrip,
				avrport:  avrport,
				avrname:  avrname,
				avrtype:  avrtype
			}

			Homey.emit('get_devices', data );
		} else {

			Homey.alert( __('pair.config.required'), 'error');
            Homey.done();
		}
	}
</script>

<style>
div.avrdiv {
    width: 100%;
}

div.avrdiv h1.avrh1 {
    text-align: center;
    font-size: 1.8em;
}
div.avrdiv p.avrrem {
    font-size: .6em;
}
div.avrdiv fieldset.fsin {
    background-color: lightgrey;
    border: 1px solid black;
}

div.avrdiv p.avr label {
    float: left;
    width: 30%;
    font: bold 0.9em Arial, Helvetica, sans-serif;
}

div.avrdiv p.avr input[type=text] {
    color: #00008B;
    background-color: #E3F2F7;
    border: 1px inset #00008B;
    width: 200px;
}

div.avrdiv p.avr select {
    width: 200px;
    background-color: #E3F2F7;
    border: 1px inset #00008B;
}

div.avrdiv p.avr input[type=checkbox] {
    width: 200px;
    background-color: #E3F2F7;
    border: 1px inset #00008B;
}
div.avrdiv input[type=button] {
    color: red;
    align: right;
    border: 1px solid black;
}
</style>

<div class="avrdiv">
	<fieldset class="fsin">
		<legend></legend>
		<p class="avr">
			<label for="avrip" data-i18n="pair.config.ipaddress">I : </label>
			<input type="text" name="avrip" id="avrip" onchange="checkIP()" required="required" value="" />
		</p>
		<p class="avr">
			<label for="avrname" data-i18n="pair.config.name">N : </label>
			<input type="text" name="avrname" id="avrname" required="required" value="" />
		</p>
		<p class="avr">
			<label for="avrtype" data-i18n="pair.config.type">P: </label>
			<select name="avrtype" id="avrtype">
                <option value=""></option>
                <option value="av8802">av8802</option>
                <option value="av8801">av8801</option>
                <option value="av7702">av7702</option>
                <option value="av7701">av7701</option>
                <option value="av7005">av7005</option>
                <option value="sr7010">sr7010</option>
                <option value="sr7009">sr7009</option>
                <option value="sr7008">sr7008</option>
                <option value="sr7007">sr7007</option>
                <option value="sr7005">sr7005</option>
                <option value="sr6010">sr6010</option>
                <option value="sr6009">sr6009</option>
                <option value="sr6008">sr6008</option>
                <option value="sr6007">sr6007</option>
                <option value="sr6006">sr6006</option>
                <option value="sr6005">sr6005</option>
                <option value="sr5010">sr5010</option>
                <option value="sr5009">sr5009</option>
                <option value="sr5008">sr5008</option>
                <option value="sr5007">sr5007</option>
                <option value="sr5006">sr5006</option>
                <option value="nr1606">nr1606</option>
                <option value="nr1605">nr1605</option>
                <option value="nr1604">nr1604</option>
                <option value="nr1603">nr1603</option>
                <option value="nr1602">nr1602</option>
                <option value="nr1506">nr1506</option>
                <option value="nr1504">nr1504</option>
            </select>
		</p>
		<!--
		<p class="avr">
            <label for="avrclstart" data-i18n="pair.config.clstart">O: </label>
            <input type='checkbox' name='avrclstart' id='avrclstart' required="required" value=""/>
        </p>
        -->
        <fieldset class="fsin">
        <button class="button" data-i18n="pair.config.saveit"
            onclick="configure();">S</button>
	    </fieldset>
	    <p class="avrrem" data-i18n="pair.config.message">Message</p>
	</fieldset>

</div>
